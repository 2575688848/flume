##############################################################################################
##
##   File Name  : flume-back-bim-service.conf
##   Flume Agent: back_bimservice
##   Description: back 方向 accountservice contentservice notifyservice storeservice	Flume 日志收集配置，采集日志直接打入Kafka topic 中
##
##############################################################################################

back_bimservice.sources = back_account_source back_content_source back_notify_source back_order_source back_goods_source back_coupon_source back_im_source back_higo_store_source php_error_source php_slow_source
back_bimservice.sinks = kafka_sink
back_bimservice.channels = kafka_channel

# 配置 sorce
back_bimservice.sources.back_account_source.type = TAILDIR
back_bimservice.sources.back_account_source.filegroups = f1
back_bimservice.sources.back_account_source.filegroups.f1 = /home/work/webdata/logs/higo_account_service/api-\.*
back_bimservice.sources.back_account_source.positionFile = /home/flume/flume/position/back_account_position.json
back_bimservice.sources.back_account_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_account_source.interceptors = i1
back_bimservice.sources.back_account_source.interceptors.i1.type = static
back_bimservice.sources.back_account_source.interceptors.i1.key = topic
back_bimservice.sources.back_account_source.interceptors.i1.value = back_account

# 配置 sorce
back_bimservice.sources.back_content_source.type = TAILDIR
back_bimservice.sources.back_content_source.filegroups = f2
back_bimservice.sources.back_content_source.filegroups.f2 = /home/work/webdata/logs/higo_content_service/api-\.*
back_bimservice.sources.back_content_source.positionFile = /home/flume/flume/position/back_content_position.json
back_bimservice.sources.back_content_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_content_source.interceptors = i2
back_bimservice.sources.back_content_source.interceptors.i2.type = static
back_bimservice.sources.back_content_source.interceptors.i2.key = topic
back_bimservice.sources.back_content_source.interceptors.i2.value = back_content

# 配置 sorce
back_bimservice.sources.back_notify_source.type = TAILDIR
back_bimservice.sources.back_notify_source.filegroups = f3
back_bimservice.sources.back_notify_source.filegroups.f3 = /home/work/webdata/logs/higo_notify_service/api-\.*
back_bimservice.sources.back_notify_source.positionFile = /home/flume/flume/position/back_notify_position.json
back_bimservice.sources.back_notify_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_notify_source.interceptors = i3
back_bimservice.sources.back_notify_source.interceptors.i3.type = static
back_bimservice.sources.back_notify_source.interceptors.i3.key = topic
back_bimservice.sources.back_notify_source.interceptors.i3.value = back_notify


# 配置 sorce
back_bimservice.sources.back_order_source.type = TAILDIR
back_bimservice.sources.back_order_source.filegroups = f5
back_bimservice.sources.back_order_source.filegroups.f5 = /home/work/webdata/logs/higo_order_service/api-\.*
back_bimservice.sources.back_order_source.positionFile = /home/flume/flume/position/back_order_position.json
back_bimservice.sources.back_order_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_order_source.interceptors = i5
back_bimservice.sources.back_order_source.interceptors.i5.type = static
back_bimservice.sources.back_order_source.interceptors.i5.key = topic
back_bimservice.sources.back_order_source.interceptors.i5.value = back_order

# 配置 sorce
back_bimservice.sources.back_goods_source.type = TAILDIR
back_bimservice.sources.back_goods_source.filegroups = f6
back_bimservice.sources.back_goods_source.filegroups.f6 = /home/work/webdata/logs/higo_goods_service/api-\.*
back_bimservice.sources.back_goods_source.positionFile = /home/flume/flume/position/back_goods_position.json
back_bimservice.sources.back_goods_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_goods_source.interceptors = i6
back_bimservice.sources.back_goods_source.interceptors.i6.type = static
back_bimservice.sources.back_goods_source.interceptors.i6.key = topic
back_bimservice.sources.back_goods_source.interceptors.i6.value = back_goods

# 配置 sorce
back_bimservice.sources.back_coupon_source.type = TAILDIR
back_bimservice.sources.back_coupon_source.filegroups = f7
back_bimservice.sources.back_coupon_source.filegroups.f7 = /home/work/webdata/logs/higo_coupon_service/api-\.*
back_bimservice.sources.back_coupon_source.positionFile = /home/flume/flume/position/back_coupon_position.json
back_bimservice.sources.back_coupon_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_coupon_source.interceptors = i7
back_bimservice.sources.back_coupon_source.interceptors.i7.type = static
back_bimservice.sources.back_coupon_source.interceptors.i7.key = topic
back_bimservice.sources.back_coupon_source.interceptors.i7.value = back_coupon

# 配置 sorce
back_bimservice.sources.back_im_source.type = TAILDIR
back_bimservice.sources.back_im_source.filegroups = f8
back_bimservice.sources.back_im_source.filegroups.f8 = /home/work/webdata/logs/higo_im_service/api-\.*
back_bimservice.sources.back_im_source.positionFile = /home/flume/flume/position/back_im_position.json
back_bimservice.sources.back_im_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_im_source.interceptors = i8
back_bimservice.sources.back_im_source.interceptors.i8.type = static
back_bimservice.sources.back_im_source.interceptors.i8.key = topic
back_bimservice.sources.back_im_source.interceptors.i8.value = back_imservice

# 配置 sorce
back_bimservice.sources.back_higo_store_source.type = TAILDIR
back_bimservice.sources.back_higo_store_source.filegroups = f9
back_bimservice.sources.back_higo_store_source.filegroups.f9 = /home/work/webdata/logs/higo_store_service/api-\.*
back_bimservice.sources.back_higo_store_source.positionFile = /home/flume/flume/position/back_higo_store_position.json
back_bimservice.sources.back_higo_store_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.back_higo_store_source.interceptors = i9
back_bimservice.sources.back_higo_store_source.interceptors.i9.type = static
back_bimservice.sources.back_higo_store_source.interceptors.i9.key = topic
back_bimservice.sources.back_higo_store_source.interceptors.i9.value = back_store

# 配置 sorce
back_bimservice.sources.php_error_source.type = TAILDIR
back_bimservice.sources.php_error_source.filegroups = f10
back_bimservice.sources.php_error_source.filegroups.f10 = /home/service/php73/log/fpm.error.log
back_bimservice.sources.php_error_source.positionFile = /home/flume/flume/position/php_error_position.json
back_bimservice.sources.php_error_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.php_error_source.interceptors = i10 i11
back_bimservice.sources.php_error_source.interceptors.i10.type = static
back_bimservice.sources.php_error_source.interceptors.i10.key = topic
back_bimservice.sources.php_error_source.interceptors.i10.value = php_error
back_bimservice.sources.php_error_source.interceptors.i11.type = com.example.interceptor.PhpErrorInterceptor$Builder


# 配置 sorce
back_bimservice.sources.php_slow_source.type = TAILDIR
back_bimservice.sources.php_slow_source.filegroups = f11
back_bimservice.sources.php_slow_source.filegroups.f11 = /home/service/php73/log/www.log.slow
back_bimservice.sources.php_slow_source.positionFile = /home/flume/flume/position/php_slow_position.json
back_bimservice.sources.php_slow_source.channels = kafka_channel
# 配置打入 Kafka 的 topic
back_bimservice.sources.php_slow_source.interceptors = i11 i12
back_bimservice.sources.php_slow_source.interceptors.i11.type = com.example.interceptor.PhpSlowInterceptor$Builder
back_bimservice.sources.php_slow_source.interceptors.i12.type = static
back_bimservice.sources.php_slow_source.interceptors.i12.key = topic
back_bimservice.sources.php_slow_source.interceptors.i12.value = php_slow


# 配置 Kafka sink 集群
back_bimservice.sinks.kafka_sink.type = org.apache.flume.sink.kafka.KafkaSink
back_bimservice.sinks.kafka_sink.brokerList = 10.20.0.19:9092,10.20.0.20:9092,10.20.0.22:9092
back_bimservice.sinks.kafka_sink.batchSize = 20
back_bimservice.sinks.kafka_sink.requiredAcks = 1

# 配置 sink channel
back_bimservice.sinks.kafka_sink.channel = kafka_channel

# 配置 channel 落磁盘方式
back_bimservice.channels.kafka_channel.type = file
back_bimservice.channels.kafka_channel.checkpointDir = /home/flume/flume/checkpoint/kafka
back_bimservice.channels.kafka_channel.dataDirs = /home/flume/flume/data/kafka
